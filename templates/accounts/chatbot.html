<!DOCTYPE html>
{% load i18n %}
{% load static %}
{% get_current_language as LANGUAGE_CODE %}
<html  x-data="data()" lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile - Edu AI</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"/>

    <!-- CSS Files -->
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.output.css' %}" />

    <!-- Alpine.js -->
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>

    <!-- Initialization Script -->
    <script src="{% static 'assets/js/init-alpine.js' %}"></script>


  <!-- fontaswom CSS -->
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
<style>
    /* RTL specific adjustments */
    {% if LANGUAGE_CODE == 'ar' %}
    body {
        direction: rtl;
        text-align: right;
    }
    .navbar .dropdown-menu {
        right: 0; /* Align dropdown to the right in RTL */
        left: auto;
    }
    .ml-3 {
        margin-right: 1rem !important; /* Adjust left margin classes */
        margin-left: 0 !important;
    }
    .ms-3 {
        margin-left: 1rem !important;
        margin-right: 0 !important;
    }
    /* Adjust other spacing and alignment rules as needed */
    {% endif %}
    /* Container Styles */
    #chat-container {
        max-width: 800px;
        margin: 40px auto;
        background-color: #f8f9fa;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
    }

/* Header Styles */
#chat-header h4 {
    font-size: 1.5rem;
    color: #333;
    margin-top: 10px;
}

#chat-subtext {
    color: #6c757d;
    font-size: 0.9rem;
}

/* Textarea Styles */
#question-input {
    width: 100%;
    border-radius: 5px;
    padding: 15px;
    font-size: 1rem;
    border: 1px solid #ced4da;
    resize: none;
    box-shadow: none;
    transition: border-color 0.3s ease;
}

#question-input:focus {
    border-color: #80bdff;
    outline: none;
    box-shadow: 0 0 5px rgba(128, 189, 255, 0.5);
}

/* Submit Button Styles */
#submit-button {
    background-color: #343a40;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    padding: 10px 20px;
    width: 100%;
    cursor: pointer;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 15px;
}

#submit-button:hover {
    background-color: #23272b;
}

#submit-button:active {
    background-color: #1d1f21;
}

/* Loading Spinner Styles */
#loading-spinner {
    border: 3px solid #f3f3f3;
    border-radius: 50%;
    border-top: 3px solid #343a40;
    width: 16px;
    height: 16px;
    animation: spin 1s linear infinite;
    margin-left: 10px;
    display: none; /* Hide by default */
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Response Container Styles */
#response-container {
    background-color: #e9f7fe;
    border: none;
    border-radius: 5px;
    padding: 15px;
    font-size: 1rem;
    color: #333;
    margin-top: 20px;
}

</style>
</head>
  <body>
    <div
      class="flex h-screen bg-gray-50 dark:bg-gray-900"
      :class="{ 'overflow-hidden': isSideMenuOpen }"
    >
      <!-- Desktop sidebar -->
      <aside
    class="z-20 hidden w-64 overflow-y-auto bg-white dark:bg-gray-800 md:block flex-shrink-0"
    {% if LANGUAGE_CODE == 'ar' %}dir="rtl"{% endif %}
>
    <div class="py-4 text-gray-500 dark:text-gray-400">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/logo.png' %}" alt="{% trans "EDUAI" %}" width="130">
        </a>
        <ul class="mt-6">
            <li class="relative px-6 py-3">
                <span
                    class="absolute inset-y-0 {% if LANGUAGE_CODE == 'ar' %}right-0{% else %}left-0{% endif %} w-1 bg-purple-600 rounded-tr-lg rounded-br-lg"
                    aria-hidden="true"
                ></span>
                <a
                    class="inline-flex items-center w-full text-sm font-semibold text-gray-800 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200 dark:text-gray-100"
                    href="{% url 'profile' %}"
                >
                    <svg
                        class="w-5 h-5"
                        aria-hidden="true"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                        ></path>
                    </svg>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "My space" %}</span>
                </a>
            </li>
        </ul>
        <ul>
            <li class="relative px-6 py-3">
                <a
                    class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    href="{% url 'subjects' %}"
                >
                    <i class="fas fa-layer-group w-5 h-5"></i>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Material" %}</span>
                </a>
            </li>
            <li class="relative px-6 py-3">
                <a
                    class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    href="#"
                >
                    <i class="fas fa-file-alt w-5 h-5"></i>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Daily Exam" %}</span>
                </a>
            </li>
            <li class="relative px-6 py-3">
                <a
                    class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    href="#"
                >
                    <i class="fas fa-calendar-alt w-5 h-5"></i>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Planner" %}</span>
                </a>
            </li>

            <li class="relative px-6 py-3">
                <button
                    class="inline-flex items-center justify-between w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    @click="togglePagesMenu"
                    aria-haspopup="true"
                >
                    <span class="inline-flex items-center">
                        <svg
                            class="w-5 h-5"
                            aria-hidden="true"
                            fill="none"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"
                            ></path>
                        </svg>
                        <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Pages" %}</span>
                    </span>
                    <svg
                        class="w-4 h-4"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a 1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"
                        ></path>
                    </svg>
                </button>
                <template x-if="isPagesMenuOpen">
                    <ul
                        x-transition:enter="transition-all ease-in-out duration-300"
                        x-transition:enter-start="opacity-25 max-h-0"
                        x-transition:enter-end="opacity-100 max-h-xl"
                        x-transition:leave="transition-all ease-in-out duration-300"
                        x-transition:leave-start="opacity-100 max-h-xl"
                        x-transition:leave-end="opacity-0 max-h-0"
                        class="p-2 mt-2 space-y-2 overflow-hidden text-sm font-medium text-gray-500 rounded-md shadow-inner bg-gray-50 dark:text-gray-400 dark:bg-gray-900"
                        aria-label="submenu"
                    >
                        <li class="px-2 py-1 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200">
                            <a class="w-full" href="{% url 'profile_edit' %}">{% trans "Edit profile" %}</a>
                        </li>
                        <li class="px-2 py-1 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200">
                            <a class="w-full" href="{% url 'password_change' %}">{% trans "Change password" %}</a>
                        </li>
                        <li class="px-2 py-1 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200">
                            <a class="w-full" href="{% url 'home' %}">{% trans "Home" %}</a>
                        </li>
                    </ul>
                </template>
            </li>
        </ul>
    </div>
</aside>
      <!-- Mobile sidebar -->
      <!-- Backdrop -->
      <div
        x-show="isSideMenuOpen"
        x-transition:enter="transition ease-in-out duration-150"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in-out duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-10 flex items-end bg-black bg-opacity-50 sm:items-center sm:justify-center"
      ></div>
      <aside
    class="fixed inset-y-0 z-20 flex-shrink-0 w-64 mt-16 overflow-y-auto bg-white dark:bg-gray-800 md:hidden"
    x-show="isSideMenuOpen"
    x-transition:enter="transition ease-in-out duration-150"
    x-transition:enter-start="opacity-0 transform {% if LANGUAGE_CODE == 'ar' %}translate-x-20{% else %}-translate-x-20{% endif %}"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in-out duration-150"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0 transform {% if LANGUAGE_CODE == 'ar' %}-translate-x-20{% else %}translate-x-20{% endif %}"
    @click.away="closeSideMenu"
    @keydown.escape="closeSideMenu"
    {% if LANGUAGE_CODE == 'ar' %}dir="rtl"{% endif %}
>
    <div class="py-4 text-gray-500 dark:text-gray-400">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/logo.png' %}" alt="{% trans "EDUAI" %}" width="130">
        </a>
        <ul class="mt-6">
            <li class="relative px-6 py-3">
                <span
                    class="absolute inset-y-0 {% if LANGUAGE_CODE == 'ar' %}right-0{% else %}left-0{% endif %} w-1 bg-purple-600 rounded-tr-lg rounded-br-lg"
                    aria-hidden="true"
                ></span>
                <a
                    class="inline-flex items-center w-full text-sm font-semibold text-gray-800 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200 dark:text-gray-100"
                    href="{% url 'profile' %}"
                >
                    <svg
                        class="w-5 h-5"
                        aria-hidden="true"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                        ></path>
                    </svg>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "My space" %}</span>
                </a>
            </li>
        </ul>

        <ul>
            <li class="relative px-6 py-3">
                <a
                    class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    href="{% url 'subjects' %}"
                >
                    <i class="fas fa-layer-group w-5 h-5"></i>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Material" %}</span>
                </a>
            </li>
            <li class="relative px-6 py-3">
                <a
                    class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    href="#"
                >
                    <i class="fas fa-file-alt w-5 h-5"></i>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Daily Exam" %}</span>
                </a>
            </li>
            <li class="relative px-6 py-3">
                <a
                    class="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    href="#"
                >
                    <i class="fas fa-calendar-alt w-5 h-5"></i>
                    <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Planner" %}</span>
                </a>
            </li>

            <li class="relative px-6 py-3">
                <button
                    class="inline-flex items-center justify-between w-full text-sm font font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                    @click="togglePagesMenu"
                    aria-haspopup="true"
                >
                    <span class="inline-flex items-center">
                        <svg
                            class="w-5 h-5"
                            aria-hidden="true"
                            fill="none"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"
                            ></path>
                        </svg>
                        <span class="{% if LANGUAGE_CODE == 'ar' %}mr-4{% else %}ml-4{% endif %}">{% trans "Pages" %}</span>
                    </span>
                    <svg
                        class="w-4 h-4"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a 1 1 0 111.414 1.414l-4 4a 1 1 0 01-1.414 0l-4-4a 1 1 0 010-1.414z"
                            clip-rule="evenodd"
                        ></path>
                    </svg>
                </button>
                <template x-if="isPagesMenuOpen">
                    <ul
                        x-transition:enter="transition-all ease-in-out duration-300"
                        x-transition:enter-start="opacity-25 max-h-0"
                        x-transition:enter-end="opacity-100 max-h-xl"
                        x-transition:leave="transition-all ease-in-out duration-300"
                        x-transition:leave-start="opacity-100 max-h-xl"
                        x-transition:leave-end="opacity-0 max-h-0"
                        class="p-2 mt-2 space-y-2 overflow-hidden text-sm font-medium text-gray-500 rounded-md shadow-inner bg-gray-50 dark:text-gray-400 dark:bg-gray-900"
                        aria-label="submenu"
                    >
                        <li class="px-2 py-1 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200">
                            <a class="w-full" href="{% url 'profile_edit' %}">{% trans "Edit profile" %}</a>
                        </li>
                        <li class="px-2 py-1 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200">
                            <a class="w-full" href="{% url 'password_change' %}">{% trans "Change password" %}</a>
                        </li>
                        <li class="px-2 py-1 transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200">
                            <a class="w-full" href="{% url 'home' %}">{% trans "Home" %}</a>
                        </li>
                    </ul>
                </template>
            </li>
        </ul>
    </div>
</aside>
      <div class="flex flex-col flex-1 w-full">
        <header class="z-10 py-4 bg-white shadow-md dark:bg-gray-800">
    <div
        class="container flex items-center justify-between h-full px-6 mx-auto text-purple-600 dark:text-purple-300"
    >
        <!-- Mobile hamburger -->
        <button
            class="p-1 {% if LANGUAGE_CODE == 'ar' %}ml-5 -mr-1{% else %}mr-5 -ml-1{% endif %} rounded-md md:hidden focus:outline-none focus:shadow-outline-purple"
            @click="toggleSideMenu"
            aria-label="Menu"
        >
            <svg
                class="w-6 h-6"
                aria-hidden="true"
                fill="currentColor"
                viewBox="0 0 20 20"
            >
                <path
                    fill-rule="evenodd"
                    d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                    clip-rule="evenodd"
                ></path>
            </svg>
        </button>

        <!-- Search input -->
        <div class="flex justify-center flex-1 {% if LANGUAGE_CODE == 'ar' %}lg:ml-32{% else %}lg:mr-32{% endif %}">
            <div class="relative w-full max-w-xl {% if LANGUAGE_CODE == 'ar' %}ml-6{% else %}mr-6{% endif %} focus-within:text-purple-500">
                <div class="absolute inset-y-0 flex items-center {% if LANGUAGE_CODE == 'ar' %}pr-2{% else %}pl-2{% endif %}">
                    <svg
                        class="w-4 h-4"
                        aria-hidden="true"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                            clip-rule="evenodd"
                        ></path>
                    </svg>
                </div>
                <input
                    class="w-full {% if LANGUAGE_CODE == 'ar' %}pr-8 pl-2{% else %}pl-8 pr-2{% endif %} text-sm text tag-gray-700 placeholder-gray-600 bg-gray-100 border-0 rounded-md dark:placeholder-gray-500 dark:focus:shadow-outline-gray dark:focus:placeholder-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:placeholder-gray-500 focus:bg-white focus:border-purple-300 focus:outline-none focus:shadow-outline-purple form-input"
                    type="text"
                    placeholder="{% trans 'Search for Chats' %}"
                    aria-label="{% trans 'Search' %}"
                />
            </div>
        </div>

        <ul class="flex items-center flex-shrink-0 {% if LANGUAGE_CODE == 'ar' %}space-x-reverse{% endif %} space-x-6">
            <!-- Profile menu -->
            <li class="relative">
                <button
                    class="align-middle rounded-full focus:shadow-outline-purple focus:outline-none"
                    @click="toggleProfileMenu"
                    @keydown.escape="closeProfileMenu"
                    aria-label="Account"
                    aria-haspopup="true"
                >
                    {% if user.profile.image %}
                        <img class="object-cover w-8 h-8 rounded-full" src="{{ user.profile.image.url }}" aria-hidden="true" />
                    {% else %}
                        <span class="font-weight-bold mt-5">{{ user.username }}</span>
                    {% endif %}
                </button>
                <template x-if="isProfileMenuOpen">
                    <ul
                        x-transition:leave="transition ease-in duration-150"
                        x-transition:leave-start="opacity-100"
                        x-transition:leave-end="opacity-0"
                        @click.away="closeProfileMenu"
                        @keydown.escape="closeProfileMenu"
                        class="absolute {% if LANGUAGE_CODE == 'ar' %}left-0{% else %}right-0{% endif %} w-56 p-2 mt-2 space-y-2 text-gray-600 bg-white border border-gray-100 rounded-md shadow-md dark:border-gray-700 dark:text-gray-300 dark:bg-gray-700"
                        aria-label="submenu"
                    >
                        <li class="flex">
                            <a
                                class="inline-flex items-center w-full px-2 py-1 text-sm font-semibold transition-colors duration-150 rounded-md hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                                href="{% url 'logout' %}"
                            >
                                <svg
                                    class="w-4 h-4 {% if LANGUAGE_CODE == 'ar' %}ml-3{% else %}mr-3{% endif %}"
                                    aria-hidden="true"
                                    fill="none"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
                                    ></path>
                                </svg>
                                <span>{% trans "Log out" %}</span>
                            </a>
                        </li>
                    </ul>
                </template>
            </li>
        </ul>
    </div>
</header>
        <main class="h-full overflow-y-auto">
            <div id="chat-container" class="container mt-5 p-4 border rounded shadow-sm mb-5">
    <div id="chat-header" class="text-center mb-4">
        <img src="{% static 'images/icons/robot.png' %}" alt="{% trans 'Robot Icon' %}" style="width: 50px;">
        <h4 class="mt-3">{% trans "Ask Your Question Below" %}</h4>
        <p id="chat-subtext" class="text-muted">{% trans "Get instant answers powered by AI." %}</p>
    </div>

    <form id="question-form">
        <div class="form-group">
            <textarea
                class="form-control {% if LANGUAGE_CODE == 'ar' %}text-right{% else %}text-left{% endif %}"
                id="question-input"
                placeholder="{% trans "What's on your mind?" %}"
                rows="4">
            </textarea>
        </div>

        <button
            type="button"
            id="submit-button"
            class="btn btn-dark mt-3">
            <span id="submit-text">{% trans "Send Message" %}</span>
            <span id="loading-spinner"></span>
        </button>
    </form>

    <div
        id="response-container"
        class="mt-4 alert alert-info {% if LANGUAGE_CODE == 'ar' %}text-right{% else %}text-left{% endif %}">
    </div>
</div>

        </main>
      </div>
    </div>
    <script>
    function getCSRFToken() {
        let csrfToken = null;
        document.cookie.split(';').forEach(cookie => {
            let trimmedCookie = cookie.trim();
            if (trimmedCookie.startsWith('csrftoken=')) {
                csrfToken = trimmedCookie.split('=')[1];
            }
        });
        return csrfToken;
    }

    document.getElementById('submit-button').addEventListener('click', function() {
        let question = document.getElementById('question-input').value;
        let responseContainer = document.getElementById('response-container');
        let loadingSpinner = document.getElementById('loading-spinner');
        let submitText = document.getElementById('submit-text');

        if (question.trim() === "") {
            alert("Please enter a question.");
            return;
        }

        loadingSpinner.style.display = 'inline-block';
        submitText.style.display = 'none';

        fetch('/subjects/api/query/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            },
            body: JSON.stringify({ query: question })
        })
        .then(response => {
            loadingSpinner.style.display = 'none';
            submitText.style.display = 'inline';
            if (response.headers.get('content-type')?.includes('application/json')) {
                return response.json();
            } else {
                throw new Error('Invalid JSON response');
            }
        })
        .then(data => {
            responseContainer.style.display = 'block';
            responseContainer.textContent = "Response: " + JSON.stringify(data);
            responseContainer.classList.remove('alert-danger');
            responseContainer.classList.add('alert-info');
        })
        .catch(error => {
            responseContainer.style.display = 'block';
            responseContainer.textContent = "An error occurred: " + error.message;
            responseContainer.classList.remove('alert-info');
            responseContainer.classList.add('alert-danger');
        });
    });
</script>
  </body>
</html>
